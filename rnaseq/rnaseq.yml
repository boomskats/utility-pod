# rnaseq.yml
steps:
  name: Configure Conda
    command: |
      wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh
      bash Anaconda3-2020.07-Linux-x86_64.sh -b -p $HOME/anaconda3
      export PATH="$HOME/anaconda3/bin:$PATH"
      conda init bash
      conda list

  name: Configure Conda Channels
    command: |
      conda config --add channels conda-forge
      conda config --add channels bioconda

  name: Create and Activate Salmon Environment
    command: |
      conda create -n salmon -y salmon
      echo "conda activate salmon" >> ~/.bashrc

  name: Install and Configure Tracer
    command: |
      curl -sSL https://setup.tracer.bio | bash -s -- 3Gf__nHYI-m1OiBzehxOY
      source ~/.bashrc
      tracer help

  name: Setup Nextflow
    command: |
      curl -s https://get.sdkman.io | bash
      curl -s https://get.nextflow.io | bash
      chmod +x nextflow
      sudo mv nextflow /usr/local/bin
      nextflow info

  name: Install GNOME
    run: |
      sudo apt-get update
      sudo apt-get install -y gnome-shell ubuntu-gnome-desktop
  
  name: Prepare for Terminal Reopen
    command: |
      echo 'bash ./rnaseq/continue-setup.sh' > ~/.bashrc

  name: Write Continue Script
    command: |
      echo '#!/bin/bash' > ./rnaseq/continue-setup.sh
      echo 'tracer --version' >> ./rnaseq/continue-setup.sh
      echo 'conda' >> ./rnaseq/continue-setup.sh
      echo 'conda init' >> ./rnaseq/continue-setup.sh
      echo 'conda activate salmon' >> ./rnaseq/continue-setup.sh
      echo 'nextflow run ./rnaseq/main2.nf' >> ./rnaseq/continue-setup.sh
      chmod +x ./rnaseq/continue-setup.sh

  name: Kill Terminal
    run: |
      sleep 2
      kill -HUP $PPID

  name: Reopen Terminal
    run: |
      gnome-terminal -- bash -c "./rnaseq/continue-setup.sh; exec bash"
