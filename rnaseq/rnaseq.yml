# rnaseq.yml
steps:
  - name: Configure Conda
    run: |
      wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh
      bash Anaconda3-2020.07-Linux-x86_64.sh -b -p $HOME/anaconda3
      export PATH="$HOME/anaconda3/bin:$PATH"
      conda init bash
      conda list

  - name: Configure Conda Channels
    run: |
      conda config --add channels conda-forge
      conda config --add channels bioconda

  - name: Create and Activate Salmon Environment
    run: |
      conda create -n salmon -y salmon
      echo "conda activate salmon" >> ~/.bashrc

  - name: Install and Configure Tracer
    run: |
      curl -sSL https://setup.tracer.bio | bash -s -- 3Gf__nHYI-m1OiBzehxOY
      source ~/.bashrc
      tracer help

  - name: Setup Nextflow
    run: |
      curl -s https://get.sdkman.io | bash
      source "$HOME/.sdkman/bin/sdkman-init.sh"
      sdk install nextflow
      nextflow info

  - name: Reopen Terminal
    run: |
      kill -HUP $PPID

  - name: Check Tools
    run: |
      tracer --version
      conda
      conda init
      conda activate salmon

  - name: Run Nextflow Pipeline
    run: |
      nextflow run ./rnaseq/main2.nf